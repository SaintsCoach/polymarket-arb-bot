<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Polymarket Arb · Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Inter:wght@300;400;500;600&display=swap">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<!-- ── Header ──────────────────────────────────────────────────────────────-->
<header class="header">
  <div class="brand">
    <span class="brand-hex">⬡</span>
    <span class="brand-name">POLYMARKET ARB</span>
    <div class="live-pill" id="live-pill">
      <span class="live-dot"></span>
      <span id="conn-label">OFFLINE</span>
    </div>
  </div>

  <!-- Tab navigation -->
  <nav class="tab-nav">
    <button class="tab-btn active" data-tab="arb">ARB BOT</button>
    <button class="tab-btn"        data-tab="mirror">MIRROR BOT</button>
    <button class="tab-btn"        data-tab="datafeed">DATA FEED</button>
    <button class="tab-btn"        data-tab="cryptoarb">CRYPTO ARB</button>
  </nav>

  <div class="stats-bar">
    <div class="stat">
      <span class="stat-lbl">OPPORTUNITIES</span>
      <span class="stat-val y" id="s-opps">0</span>
    </div>
    <div class="sep"></div>
    <div class="stat">
      <span class="stat-lbl">EXECUTED</span>
      <span class="stat-val g" id="s-exec">0</span>
    </div>
    <div class="sep"></div>
    <div class="stat">
      <span class="stat-lbl">ABORTED</span>
      <span class="stat-val r" id="s-abort">0</span>
    </div>
    <div class="sep"></div>
    <div class="stat">
      <span class="stat-lbl">SIM. P&amp;L</span>
      <span class="stat-val g" id="s-pnl">+$0.0000</span>
    </div>
    <div class="sep"></div>
    <div class="stat">
      <span class="stat-lbl">BALANCE</span>
      <span class="stat-val" id="s-bal">$10,000.00</span>
    </div>
    <div class="sep"></div>
    <div class="stat">
      <span class="stat-lbl">UPTIME</span>
      <span class="stat-val" style="font-family:var(--mono)" id="s-uptime">00:00:00</span>
    </div>
  </div>
</header>

<!-- ════════════════════════════════════════════════════════════════════════ -->
<!-- ARB BOT TAB                                                             -->
<!-- ════════════════════════════════════════════════════════════════════════ -->
<div id="tab-arb" class="tab-content active">
<div class="grid">

  <!-- Left: Market Scanner -->
  <aside class="panel">
    <div class="p-head">
      <span class="p-title">MARKET SCANNER</span>
      <span class="scan-indicator">
        <span class="scan-ring"></span>
        SCANNING
      </span>
    </div>
    <div class="scan-meta">
      <div class="scan-kv">
        <span class="scan-k">Markets</span>
        <span class="scan-v" id="sc-total">—</span>
      </div>
      <div class="scan-kv">
        <span class="scan-k">Candidates</span>
        <span class="scan-v y" id="sc-cands">—</span>
      </div>
      <div class="scan-kv">
        <span class="scan-k">Scan ms</span>
        <span class="scan-v" id="sc-ms">—</span>
      </div>
    </div>
    <div class="candidate-list" id="cand-list">
      <div class="empty">Waiting for first scan…</div>
    </div>
  </aside>

  <!-- Center: Opportunity feed + Trade log -->
  <div class="col-mid">

    <!-- Opportunity feed -->
    <section class="panel">
      <div class="p-head">
        <span class="p-title">OPPORTUNITY FEED</span>
        <span class="badge y" id="opp-badge">0 found</span>
      </div>
      <div class="feed" id="opp-feed">
        <div class="empty">Monitoring markets for arbitrage opportunities…</div>
      </div>
    </section>

    <!-- Trade log -->
    <section class="panel">
      <div class="p-head">
        <span class="p-title">TRADE EXECUTION LOG</span>
        <span class="badge" id="trade-badge">0 trades</span>
      </div>
      <div class="feed" id="trade-feed">
        <div class="empty">No trades attempted yet.</div>
      </div>
    </section>

  </div>

  <!-- Right: P&L Chart -->
  <aside class="panel">
    <div class="p-head">
      <span class="p-title">CUMULATIVE P&amp;L</span>
      <span class="stat-val g" style="font-family:var(--mono);font-size:13px" id="chart-pnl">+$0.0000</span>
    </div>
    <div class="chart-wrap">
      <canvas id="pnl-chart"></canvas>
    </div>
    <div class="chart-footer">
      <span class="legend-dot g">●</span>
      Simulated profit (USDC)
    </div>
  </aside>

</div><!-- .grid -->
</div><!-- #tab-arb -->

<!-- ════════════════════════════════════════════════════════════════════════ -->
<!-- MIRROR BOT TAB                                                          -->
<!-- ════════════════════════════════════════════════════════════════════════ -->
<div id="tab-mirror" class="tab-content">
<div class="mirror-grid">

  <!-- Left column: Portfolio Overview + Watched Addresses -->
  <div class="mirror-left">

    <!-- Portfolio overview -->
    <section class="panel">
      <div class="p-head">
        <span class="p-title">PORTFOLIO</span>
        <span class="badge" id="m-slot-badge">0 / 200 slots</span>
        <button class="btn-danger" id="btn-reset">↺ Reset</button>
      </div>
      <div class="overview-grid">
        <div class="ov-cell">
          <span class="ov-lbl">BALANCE</span>
          <span class="ov-val" id="m-balance">$20,000.00</span>
        </div>
        <div class="ov-cell">
          <span class="ov-lbl">DEPLOYED</span>
          <span class="ov-val" id="m-deployed">$0.00</span>
        </div>
        <div class="ov-cell">
          <span class="ov-lbl">REALIZED P&amp;L</span>
          <span class="ov-val g" id="m-realized">+$0.0000</span>
        </div>
        <div class="ov-cell">
          <span class="ov-lbl">UNREALIZED P&amp;L</span>
          <span class="ov-val" id="m-unrealized">$0.0000</span>
        </div>
        <div class="ov-cell">
          <span class="ov-lbl">TOTAL P&amp;L</span>
          <span class="ov-val g" id="m-total-pnl">+$0.0000</span>
        </div>
        <div class="ov-cell">
          <span class="ov-lbl">QUEUE</span>
          <span class="ov-val y" id="m-queue-cnt">0</span>
        </div>
        <div class="ov-cell ov-wide">
          <span class="ov-lbl">MONITORING SINCE</span>
          <span class="ov-val" id="m-start-ts">—</span>
        </div>
      </div>
    </section>

    <!-- Watched addresses -->
    <section class="panel" style="flex:1;min-height:0;">
      <div class="p-head">
        <span class="p-title">WATCHED ADDRESSES</span>
        <button class="btn-add" id="btn-add-addr">+ ADD</button>
      </div>
      <div class="addr-list" id="addr-list">
        <div class="empty">No addresses configured.</div>
      </div>

      <!-- Add address form (hidden by default) -->
      <div class="add-form" id="add-form" style="display:none;">
        <input class="form-input" id="f-addr"  type="text" placeholder="0x wallet address" />
        <input class="form-input" id="f-nick"  type="text" placeholder="Nickname" />
        <div class="form-row">
          <button class="btn-primary" id="btn-submit-addr">Add</button>
          <button class="btn-cancel"  id="btn-cancel-addr">Cancel</button>
        </div>
      </div>
    </section>

  </div><!-- .mirror-left -->

  <!-- Center column: Open Positions + Queue -->
  <div class="mirror-center">

    <!-- Open positions table -->
    <section class="panel" style="flex:2;min-height:0;">
      <div class="p-head">
        <span class="p-title">OPEN POSITIONS</span>
        <span class="badge g" id="m-pos-badge">0 open</span>
      </div>
      <div class="tbl-wrap">
        <table class="pos-table">
          <thead>
            <tr>
              <th>Market</th>
              <th>Side</th>
              <th>Entry</th>
              <th>Current</th>
              <th>Unreal. P&amp;L</th>
              <th>Age</th>
              <th>Copier</th>
            </tr>
          </thead>
          <tbody id="pos-tbody">
            <tr><td colspan="7" class="empty">No open positions.</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Trade queue -->
    <section class="panel" style="flex:1;min-height:0;">
      <div class="p-head">
        <span class="p-title">TRADE QUEUE</span>
        <span class="badge y" id="m-queue-badge">0 queued</span>
      </div>
      <div class="tbl-wrap">
        <table class="pos-table">
          <thead>
            <tr><th>Market</th><th>Side</th><th>Entry</th><th>Copier</th><th>Queued</th></tr>
          </thead>
          <tbody id="queue-tbody">
            <tr><td colspan="5" class="empty">Queue is empty.</td></tr>
          </tbody>
        </table>
      </div>
    </section>

  </div><!-- .mirror-center -->

  <!-- Right column: P&L Chart + Resolved trades -->
  <div class="mirror-right">

    <section class="panel">
      <div class="p-head">
        <span class="p-title">TOTAL P&amp;L</span>
        <span class="ov-val g" style="font-family:var(--mono);font-size:13px" id="mirror-chart-pnl">+$0.0000</span>
      </div>
      <div class="chart-wrap">
        <canvas id="mirror-pnl-chart"></canvas>
      </div>
      <div class="chart-footer">
        <span class="legend-dot g">●</span>
        Realized + unrealized (USDC)
      </div>
    </section>

    <section class="panel" style="flex:1;min-height:0;">
      <div class="p-head">
        <span class="p-title">RESOLVED TRADES</span>
        <span class="badge" id="m-resolved-badge">0 closed</span>
      </div>
      <div class="feed" id="m-resolved-feed">
        <div class="empty">No closed positions yet.</div>
      </div>
    </section>

    <!-- RN1 Analysis panel -->
    <section class="panel" style="flex-shrink:0;" id="rn1-panel">
      <div class="p-head">
        <span class="p-title">RN1 TRADE ANALYSIS</span>
        <span style="display:flex;gap:6px;align-items:center">
          <span class="badge" id="rn1-meta">--</span>
          <button class="btn-sm" id="btn-rn1-refresh">↺</button>
        </span>
      </div>
      <!-- Sizing row -->
      <div class="overview-grid" id="rn1-sizing-grid" style="display:none">
        <div class="ov-cell">
          <span class="ov-lbl">MEDIAN SIZE</span>
          <span class="ov-val" id="rn1-median">—</span>
        </div>
        <div class="ov-cell">
          <span class="ov-lbl">MEAN SIZE</span>
          <span class="ov-val" id="rn1-mean">—</span>
        </div>
        <div class="ov-cell">
          <span class="ov-lbl">P95 SIZE</span>
          <span class="ov-val y" id="rn1-p95">—</span>
        </div>
        <div class="ov-cell">
          <span class="ov-lbl">MAX SIZE</span>
          <span class="ov-val y" id="rn1-max">—</span>
        </div>
        <div class="ov-cell">
          <span class="ov-lbl">YES / NO</span>
          <span class="ov-val" id="rn1-yn">—</span>
        </div>
        <div class="ov-cell">
          <span class="ov-lbl">AVG ENTRY</span>
          <span class="ov-val" id="rn1-avg-price">—</span>
        </div>
        <div class="ov-cell">
          <span class="ov-lbl">30D TRADES</span>
          <span class="ov-val" id="rn1-30d">—</span>
        </div>
        <div class="ov-cell">
          <span class="ov-lbl">PER DAY</span>
          <span class="ov-val" id="rn1-per-day">—</span>
        </div>
      </div>
      <!-- Category bar -->
      <div id="rn1-cats" style="padding:6px 14px 8px;display:none">
        <div style="font-size:9px;letter-spacing:0.08em;color:var(--muted);margin-bottom:5px">TOP CATEGORIES</div>
        <div id="rn1-cat-bars"></div>
      </div>
      <!-- Size distribution -->
      <div id="rn1-buckets" style="padding:0 14px 10px;display:none">
        <div style="font-size:9px;letter-spacing:0.08em;color:var(--muted);margin-bottom:5px">SIZE DISTRIBUTION</div>
        <div id="rn1-bucket-bars"></div>
      </div>
    </section>

  </div><!-- .mirror-right -->

</div><!-- .mirror-grid -->

<!-- Debug panel -->
<div class="debug-panel" id="debug-panel">
  <div class="debug-head">
    <span class="debug-title">⬡ POLL DEBUG</span>
    <button class="debug-close" id="debug-close">✕</button>
  </div>
  <div id="debug-log"></div>
</div>
<button class="debug-toggle" id="debug-toggle">DEBUG</button>

</div><!-- #tab-mirror -->

<!-- ════════════════════════════════════════════════════════════════════════ -->
<!-- DATA FEED TAB                                                           -->
<!-- ════════════════════════════════════════════════════════════════════════ -->
<div id="tab-datafeed" class="tab-content">
<div class="mirror-grid">

  <!-- Left column: Portfolio Overview + Live Events -->
  <div class="mirror-left">

    <!-- Portfolio overview -->
    <section class="panel">
      <div class="p-head">
        <span class="p-title">PORTFOLIO</span>
        <span class="badge" id="df-slot-badge">0 / 40 slots</span>
        <button class="btn-danger" id="btn-df-reset">↺ Reset</button>
      </div>
      <div class="overview-grid">
        <div class="ov-cell">
          <span class="ov-lbl">BALANCE</span>
          <span class="ov-val" id="df-balance">$20,000.00</span>
        </div>
        <div class="ov-cell">
          <span class="ov-lbl">DEPLOYED</span>
          <span class="ov-val" id="df-deployed">$0.00</span>
        </div>
        <div class="ov-cell">
          <span class="ov-lbl">REALIZED P&amp;L</span>
          <span class="ov-val g" id="df-realized">+$0.0000</span>
        </div>
        <div class="ov-cell">
          <span class="ov-lbl">UNREALIZED P&amp;L</span>
          <span class="ov-val" id="df-unrealized">$0.0000</span>
        </div>
        <div class="ov-cell">
          <span class="ov-lbl">TOTAL P&amp;L</span>
          <span class="ov-val g" id="df-total-pnl">+$0.0000</span>
        </div>
        <div class="ov-cell">
          <span class="ov-lbl">SLOTS</span>
          <span class="ov-val y" id="df-slots">0 / 40</span>
        </div>
        <div class="ov-cell ov-wide">
          <span class="ov-lbl">MONITORING SINCE</span>
          <span class="ov-val" id="df-start-ts">—</span>
        </div>
      </div>
    </section>

    <!-- Live Events feed -->
    <section class="panel" style="flex:1;min-height:0;">
      <div class="p-head">
        <span class="p-title">LIVE EVENTS</span>
        <span style="display:flex;gap:6px;align-items:center">
          <span class="badge" id="df-api-badge-af" title="API-Football quota">AF —</span>
          <span class="badge" id="df-api-badge-sr" title="Sportradar quota">SR —</span>
        </span>
      </div>
      <div class="feed" id="df-event-feed">
        <div class="empty">Waiting for live soccer events…</div>
      </div>
    </section>

  </div><!-- .mirror-left -->

  <!-- Center column: Opportunities + Open Positions -->
  <div class="mirror-center">

    <!-- Opportunity feed -->
    <section class="panel" style="flex:1;min-height:0;">
      <div class="p-head">
        <span class="p-title">OPPORTUNITY FEED</span>
        <span class="badge y" id="df-opp-badge">0 found</span>
      </div>
      <div class="feed" id="df-opp-feed">
        <div class="empty">No opportunities detected yet.</div>
      </div>
    </section>

    <!-- Open positions table -->
    <section class="panel" style="flex:2;min-height:0;">
      <div class="p-head">
        <span class="p-title">OPEN POSITIONS</span>
        <span class="badge g" id="df-pos-badge">0 open</span>
      </div>
      <div class="tbl-wrap">
        <table class="pos-table">
          <thead>
            <tr>
              <th>Market</th>
              <th>Side</th>
              <th>Entry</th>
              <th>Current</th>
              <th>Unreal. P&amp;L</th>
              <th>Age</th>
              <th>Trigger</th>
            </tr>
          </thead>
          <tbody id="df-pos-tbody">
            <tr><td colspan="7" class="empty">No open positions.</td></tr>
          </tbody>
        </table>
      </div>
    </section>

  </div><!-- .mirror-center -->

  <!-- Right column: P&L Chart + Resolved trades -->
  <div class="mirror-right">

    <section class="panel">
      <div class="p-head">
        <span class="p-title">TOTAL P&amp;L</span>
        <span class="ov-val g" style="font-family:var(--mono);font-size:13px" id="df-chart-pnl">+$0.0000</span>
      </div>
      <div class="chart-wrap">
        <canvas id="datafeed-pnl-chart"></canvas>
      </div>
      <div class="chart-footer">
        <span class="legend-dot g">●</span>
        Realized + unrealized (USDC)
      </div>
    </section>

    <section class="panel" style="flex:1;min-height:0;">
      <div class="p-head">
        <span class="p-title">RESOLVED TRADES</span>
        <span class="badge" id="df-resolved-badge">0 closed</span>
      </div>
      <div class="feed" id="df-resolved-feed">
        <div class="empty">No closed positions yet.</div>
      </div>
    </section>

    <!-- Edge Latency panel -->
    <section class="panel" style="flex:1;min-height:0;">
      <div class="p-head">
        <span class="p-title">EDGE LATENCY</span>
        <span class="badge" id="df-edge-stats">--</span>
      </div>
      <div class="tbl-wrap">
        <table class="pos-table">
          <thead>
            <tr>
              <th>Event</th>
              <th>Latency</th>
              <th>ΔPrice</th>
              <th>Feed</th>
            </tr>
          </thead>
          <tbody id="df-edge-tbody">
            <tr><td colspan="4" class="empty">No measurements yet.</td></tr>
          </tbody>
        </table>
      </div>
    </section>

  </div><!-- .mirror-right -->

</div><!-- .mirror-grid -->
</div><!-- #tab-datafeed -->

<script src="/static/app.js"></script>
<!-- ════════════════════════════════════════════════════════════════════════ -->
<!-- CRYPTO ARB TAB                                                          -->
<!-- ════════════════════════════════════════════════════════════════════════ -->
<div id="tab-cryptoarb" class="tab-content">
<div class="mirror-grid">

  <!-- ── LEFT ──────────────────────────────────────────────────────────── -->
  <div class="mirror-left">

    <!-- Stats overview -->
    <div class="panel" style="flex-shrink:0">
      <div class="p-head"><span class="p-title">CRYPTO ARB OVERVIEW</span>
        <button class="small-btn" id="ca-reset-btn">RESET</button>
      </div>
      <div class="ov-grid">
        <div class="ov-cell"><span class="ov-lbl">BALANCE</span><span class="ov-val" id="ca-balance">$20,000.00</span></div>
        <div class="ov-cell"><span class="ov-lbl">REALIZED P&amp;L</span><span class="ov-val" id="ca-pnl">$0.00</span></div>
        <div class="ov-cell"><span class="ov-lbl">TOTAL SCANS</span><span class="ov-val" id="ca-scans">0</span></div>
        <div class="ov-cell"><span class="ov-lbl">OPPORTUNITIES</span><span class="ov-val y" id="ca-opps">0</span></div>
        <div class="ov-cell"><span class="ov-lbl">TRADES</span><span class="ov-val g" id="ca-trades">0</span></div>
        <div class="ov-cell"><span class="ov-lbl">PAIRS WATCHED</span><span class="ov-val" id="ca-pairs">—</span></div>
      </div>
      <div style="padding:8px 12px;font-size:11px;color:var(--muted)">
        Monitoring since <span id="ca-since">—</span>
      </div>
    </div>

    <!-- Exchange health -->
    <div class="panel" style="flex-shrink:0">
      <div class="p-head"><span class="p-title">EXCHANGE HEALTH</span></div>
      <div style="display:flex;gap:20px;padding:10px 14px;align-items:center">
        <div style="display:flex;align-items:center;gap:8px">
          <span id="ca-health-cb-dot" style="width:10px;height:10px;border-radius:50%;background:var(--muted);display:inline-block"></span>
          <span style="font-family:var(--mono);font-size:12px">COINBASE</span>
          <span id="ca-health-cb-lbl" style="font-size:11px;color:var(--muted)">—</span>
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <span id="ca-health-kr-dot" style="width:10px;height:10px;border-radius:50%;background:var(--muted);display:inline-block"></span>
          <span style="font-family:var(--mono);font-size:12px">KRAKEN</span>
          <span id="ca-health-kr-lbl" style="font-size:11px;color:var(--muted)">—</span>
        </div>
      </div>
    </div>

    <!-- Top pairs -->
    <div class="panel" style="flex:1;min-height:0">
      <div class="p-head"><span class="p-title">TOP PAIRS</span></div>
      <div id="ca-top-pairs" style="padding:6px 0;overflow-y:auto;height:calc(100% - 36px)"></div>
    </div>

  </div><!-- mirror-left -->

  <!-- ── CENTER ─────────────────────────────────────────────────────────── -->
  <div class="mirror-center">

    <!-- Live scan feed -->
    <div class="panel" style="flex:0 0 220px">
      <div class="p-head">
        <span class="p-title">LIVE SCAN FEED</span>
        <span id="ca-scan-meta" style="font-size:11px;color:var(--muted)">waiting for first scan…</span>
      </div>
      <div style="overflow-x:auto">
        <table class="pos-table" style="width:100%">
          <thead><tr>
            <th>PAIR</th><th>CB ASK</th><th>KR BID</th><th>RAW %</th><th>NET %</th>
          </tr></thead>
          <tbody id="ca-scan-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- Opportunity cards -->
    <div class="panel" style="flex:1;min-height:0">
      <div class="p-head"><span class="p-title">OPPORTUNITIES</span>
        <span id="ca-opp-count-lbl" style="font-size:11px;color:var(--muted)">0 detected</span>
      </div>
      <div id="ca-opp-feed" class="feed" style="height:calc(100% - 36px)"></div>
    </div>

  </div><!-- mirror-center -->

  <!-- ── RIGHT ──────────────────────────────────────────────────────────── -->
  <div class="mirror-right">

    <!-- P&L Chart -->
    <div class="panel chart-wrap" style="flex:0 0 200px">
      <div class="p-head"><span class="p-title">CUMULATIVE P&amp;L</span></div>
      <canvas id="ca-pnl-chart"></canvas>
    </div>

    <!-- Trade log -->
    <div class="panel" style="flex:1;min-height:0">
      <div class="p-head"><span class="p-title">TRADE LOG</span></div>
      <div style="overflow-x:auto;height:calc(100% - 36px);overflow-y:auto">
        <table class="pos-table" style="width:100%">
          <thead><tr>
            <th>TIME</th><th>PAIR</th><th>BUY</th><th>SELL</th><th>NET%</th><th>P&amp;L</th>
          </tr></thead>
          <tbody id="ca-trade-tbody"></tbody>
        </table>
      </div>
    </div>

  </div><!-- mirror-right -->

</div><!-- mirror-grid -->
</div><!-- #tab-cryptoarb -->

<script src="/static/mirror.js"></script>
<script src="/static/datafeed.js"></script>
<script src="/static/crypto_arb.js"></script>
</body>
</html>
